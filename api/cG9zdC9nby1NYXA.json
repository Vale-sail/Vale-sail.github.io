{"title":"go Map","date":"2021-11-30T09:02:00.000Z","author":"Vale Sail","slug":"go-Map","tags":["go"],"updated":"2021-12-01T02:55:29.826Z","content":"<h3 id=\"Map\">Map<a href=\"post/go-Map#Map\"></a></h3><h5 id=\"冲突解决\">冲突解决<a href=\"post/go-Map#冲突解决\"></a></h5><blockquote>\n<p>链表法解决(redis也是此方法)</p>\n</blockquote>\n<h5 id=\"基础结构\">基础结构<a href=\"post/go-Map#基础结构\"></a></h5><h6 id=\"hamp\">hamp<a href=\"post/go-Map#hamp\"></a></h6><ol>\n<li>hmap count表示hash表的有元素</li>\n<li>B hash表持有的桶h的对数 ;2^B个桶的数据</li>\n<li>hash0 随机种子</li>\n<li>oldbuckets标示扩容钱的buckets</li>\n</ol>\n<div class=\"article-img\"><p><img src=\"/images/image_go_hmap.png\" alt=\"upload successful\" data-zoomable></p></div>\n<blockquote>\n<p>图片源于(侵权必删) <a href=\"https://draveness.me/golang/docs/part2-foundation/ch03-datastructure/golang-hashmap/#335-%E5%B0%8F%E7%BB%93\" target=\"_blank\" rel=\"noopener\">https://draveness.me/golang/docs/part2-foundation/ch03-datastructure/golang-hashmap/#335-%E5%B0%8F%E7%BB%93</a></p>\n</blockquote>\n<h6 id=\"bmap-8个元素\">bmap 8个元素<a href=\"post/go-Map#bmap-8个元素\"></a></h6><ol>\n<li>tophash 8个数组：存储高8位的hash，能够加速访问;查找时优先比对tophash是否一样，一致在对比hash</li>\n<li>Kkkkvvvv的存储布局，能够有效减少字节对齐浪费的内存空间，</li>\n</ol>\n<div class=\"article-img\"><p><img src=\"/images/image_go_bmap.png\" alt=\"upload successful\" data-zoomable></p></div>\n<blockquote>\n<p>图片源于(侵权必删) <a href=\"https://draveness.me/golang/docs/part2-foundation/ch03-datastructure/golang-hashmap/#335-%E5%B0%8F%E7%BB%93\" target=\"_blank\" rel=\"noopener\">https://draveness.me/golang/docs/part2-foundation/ch03-datastructure/golang-hashmap/#335-%E5%B0%8F%E7%BB%93</a></p>\n</blockquote>\n<h5 id=\"内存分配\">内存分配<a href=\"post/go-Map#内存分配\"></a></h5><p>小于8个直接分配到栈上，创建时会分配2^n-4个溢出桶</p>\n<h6 id=\"初始化：\">初始化：<a href=\"post/go-Map#初始化：\"></a></h6><ol>\n<li>小于8个直接分配到栈上</li>\n<li>小于等于25个元素直接初始化，大于使用for 循环初始化</li>\n<li>创建时会创建2^n-4个溢出桶</li>\n</ol>\n<h6 id=\"访问\">访问<a href=\"post/go-Map#访问\"></a></h6><ol>\n<li>如有oldbuckets中，使用oldbuckets来代替buckets提供数据    </li>\n<li>使用hash计算确定桶的位置，然后使用tophash进行对比</li>\n<li>tophash一致，对比hash是否一致</li>\n<li>不一致查看溢出桶</li>\n</ol>\n<h5 id=\"扩容\">扩容<a href=\"post/go-Map#扩容\"></a></h5><h6 id=\"扩容条件\">扩容条件<a href=\"post/go-Map#扩容条件\"></a></h6><ol>\n<li>装载因子大于6.5</li>\n<li>溢出桶太多2^B个桶</li>\n</ol>\n<h6 id=\"扩容时机\">扩容时机<a href=\"post/go-Map#扩容时机\"></a></h6><ol>\n<li>赋值时，判断扩容条件</li>\n<li>增量扩容，每次写入和删除分摊扩容成本 (做法和redis一直)</li>\n</ol>\n","prev":{"title":"Go GC","slug":"Go-GC"},"next":{"title":"kafka笔记","slug":"kafka笔记"},"link":"https://vale-sail.github.io/post/go-Map/"}